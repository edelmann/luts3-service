
=== Documentation for SGAS views ===

Just inserting usage records in itself is rather useless. In order to provide
high level information about the usage record data, you should configure a set
of views. As it varies a lot what information people are interested in, it is
possible to create custom views. In fact SGAS doesn't come with any stock (but
has some examples).

* Some definitions

A database has a number of design documents (zero when created)
A design document contains one or more views.

Views in CouchDB are materilized, meaning views are (partly) saved on disk.
This means that the first view access is typically rather expensive (it has to
be created), but the following are _VERY_ fast.

To create a view, there are the following steps:

1. Figure out which information is wanted.
2. Write the query.
3. Configure SGAS to provide access the view.
4. Set authorization for who can acccess the view.

None of these steps are particular difficult. The following presents an example
of a creating a view.

=== Creating a view ===

1. We would like to know the aggregated wall duration per machine per day.

2. We create a view in CouchDB, which is written in javascript, using
   map-reduce. A function is provided for the map step, and potentially
   another for the reduce step (not required).




function(doc) {
    emit([doc.machine_name, doc.start_time.substring(0,10)], doc.wall_duration);
}

function (key, values) {
    return sum(values);
}




=== More View Examples ===

Example view code:

Aggregated wall duration per machine per day:

function(doc) {
    emit([doc.machine_name, doc.start_time.substring(0,10)], doc.wall_duration);
}

function (key, values) {
    return sum(values);
}


Aggregated wall duration per global user name per day:

function(doc) {
    emit([doc.global_user_name, doc.start_time.substring(0,10)], doc.wall_duration);
}

function (key, values) {
    return sum(values);
}

